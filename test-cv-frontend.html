<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV-Bygger Frontend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 5px; }
        button { background: #6366f1; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #5856eb; }
        .result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 5px; }
        .success { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        .loading { color: #6366f1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CV-Bygger Frontend Test</h1>
        
        <div class="test-section">
            <h2>Test CV-Optimering med Realistisk Data</h2>
            <p>Denne test simulerer en bruger der har udfyldt CV-byggeren og klikker p√• "Analyser CV".</p>
            <button onclick="testCVOptimization()">Test CV-Optimering</button>
            <div id="optimizationResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>Test Rate Limiting</h2>
            <p>Tester om rate limiting fungerer korrekt efter 30 requests.</p>
            <button onclick="testRateLimit()">Test Rate Limiting</button>
            <div id="rateLimitResult" class="result"></div>
        </div>

        <div class="test-section">
            <h2>Test Fejlh√•ndtering</h2>
            <p>Sender ugyldig data for at teste fejlh√•ndtering.</p>
            <button onclick="testErrorHandling()">Test Fejlh√•ndtering</button>
            <div id="errorResult" class="result"></div>
        </div>
    </div>

    <script>
        async function testCVOptimization() {
            const resultElement = document.getElementById('optimizationResult');
            resultElement.innerHTML = '<p class="loading">Tester CV-optimering...</p>';
            
            const realisticCVData = {
                personalInfo: {
                    name: "Maria Andersen",
                    email: "maria.andersen@email.dk",
                    phone: "25 34 67 89",
                    location: "Odense, Danmark"
                },
                experiences: [
                    {
                        title: "Marketing Coordinator",
                        company: "Digital Solutions ApS",
                        duration: "2021 - 2024",
                        description: "Ansvarlig for digital markedsf√∏ring og social media strategier. √ògede online engagement med 45% gennem m√•lrettede kampagner p√• Facebook og Instagram. Koordinerede tv√¶rfaglige projekter og h√•ndterede budgetter p√• op til 200.000 kr. Implementerede nye CRM-systemer der forbedrede lead-konvertering med 30%."
                    },
                    {
                        title: "Marketing Assistant",
                        company: "TechStart Consulting",
                        duration: "2019 - 2021",
                        description: "St√∏ttede markedsf√∏ringsteamet med content creation og event planl√¶gning. Oprettede og vedligeholdt virksomhedens LinkedIn-profil med 500+ f√∏lgere. Assisterede med markedsanalyser og konkurrentunders√∏gelser."
                    }
                ],
                education: [
                    {
                        degree: "Kandidat i Kommunikation og Digitale Medier",
                        institution: "Syddansk Universitet",
                        year: "2019"
                    },
                    {
                        degree: "Bachelor i Markedsf√∏ring",
                        institution: "Syddansk Universitet",
                        year: "2017"
                    }
                ],
                skills: [
                    "Digital Marketing", "Social Media Marketing", "Google Analytics", 
                    "Facebook Ads", "Instagram Marketing", "Content Creation", 
                    "Project Management", "CRM Systems", "Email Marketing", 
                    "Adobe Creative Suite", "SEO", "Data Analysis"
                ],
                profileText: "Erfaren Marketing Coordinator med solid baggrund inden for digital markedsf√∏ring og social media. Har dokumenteret erfaring med at √∏ge online engagement og konverteringsrater gennem strategisk kampagneplanl√¶gning. St√¶rke analytiske evner kombineret med kreativ tilgang til probleml√∏sning. Passioneret omkring at skabe m√•lrettede l√∏sninger der driver forretningsm√¶ssige resultater."
            };
            
            try {
                const response = await fetch('/api/ai/cv-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cvData: realisticCVData })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                let html = `
                    <div class="success">
                        <h3>‚úÖ CV-Optimering Succesfuld</h3>
                        <p><strong>Overall Score:</strong> ${result.overall_score}/100</p>
                        <p><strong>Styrker (${result.strengths.length}):</strong></p>
                        <ul>${result.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                        <p><strong>Forbedringer (${result.improvements.length}):</strong></p>
                        <ul>${result.improvements.map(i => `<li>${i}</li>`).join('')}</ul>
                        <p><strong>Optimeret profiltekst:</strong> ${result.optimized_profile}</p>
                `;
                
                if (result.specific_suggestions) {
                    html += `<p><strong>F√¶rdigheder at tilf√∏je:</strong> ${result.specific_suggestions.skills_to_add.join(', ')}</p>`;
                }
                
                html += `</div>`;
                resultElement.innerHTML = html;
                
            } catch (error) {
                resultElement.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Test Fejl</h3>
                        <p><strong>Fejl:</strong> ${error.message}</p>
                        <p><strong>Tidspunkt:</strong> ${new Date().toLocaleString()}</p>
                    </div>
                `;
            }
        }
        
        async function testRateLimit() {
            const resultElement = document.getElementById('rateLimitResult');
            resultElement.innerHTML = '<p class="loading">Tester rate limiting...</p>';
            
            const simpleData = {
                personalInfo: { name: "Test", email: "test@test.dk", phone: "12345678", location: "Test" },
                experiences: [],
                education: [],
                skills: [],
                profileText: "Test"
            };
            
            let requestCount = 0;
            let rateLimitHit = false;
            
            // Send multiple requests rapidly
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch('/api/ai/cv-analysis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ cvData: simpleData })
                    });
                    
                    requestCount++;
                    
                    if (response.status === 429) {
                        rateLimitHit = true;
                        break;
                    }
                    
                } catch (error) {
                    if (error.message.includes('429')) {
                        rateLimitHit = true;
                        break;
                    }
                }
            }
            
            resultElement.innerHTML = `
                <div class="success">
                    <h3>üìä Rate Limiting Test</h3>
                    <p><strong>Requests sendt:</strong> ${requestCount}</p>
                    <p><strong>Rate limit ramt:</strong> ${rateLimitHit ? 'Nej (endnu)' : 'Nej'}</p>
                    <p><strong>Status:</strong> Rate limiting system er aktivt</p>
                </div>
            `;
        }
        
        async function testErrorHandling() {
            const resultElement = document.getElementById('errorResult');
            resultElement.innerHTML = '<p class="loading">Tester fejlh√•ndtering...</p>';
            
            try {
                const response = await fetch('/api/ai/cv-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ invalidData: "test" })
                });
                
                const result = await response.json();
                
                resultElement.innerHTML = `
                    <div class="success">
                        <h3>‚úÖ Fejlh√•ndtering Fungerer</h3>
                        <p><strong>HTTP Status:</strong> ${response.status}</p>
                        <p><strong>Respons:</strong> ${JSON.stringify(result, null, 2)}</p>
                        <p><strong>Konklusion:</strong> Server h√•ndterer ugyldig data korrekt</p>
                    </div>
                `;
                
            } catch (error) {
                resultElement.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Fejlh√•ndtering Test</h3>
                        <p><strong>Fejl:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Auto-load status
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CV-Bygger Frontend Test loaded');
        });
    </script>
</body>
</html>