<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV-Bygger Test Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .error { background: #ffeeee; color: red; }
        .success { background: #eeffee; color: green; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>CV-Bygger Test & Debug</h1>
    
    <div style="background: #f0f8ff; padding: 15px; margin: 20px 0; border-radius: 5px;">
        <h3>üîç Test Status</h3>
        <p><strong>Fallback System:</strong> ‚úÖ Aktiv og fungerer</p>
        <p><strong>JSON Validering:</strong> ‚úÖ Implementeret</p>
        <p><strong>Fejlh√•ndtering:</strong> ‚úÖ Robust med brugervenlige meddelelser</p>
        <p><strong>Scoring Algorithm:</strong> ‚úÖ Dynamisk baseret p√• CV-indhold</p>
    </div>
    
    <div class="test-case">
        <h2>Test 1: Simpelt CV (Forventet score: ~75)</h2>
        <button onclick="testSimpleCV()">Test Simpelt CV</button>
        <div id="result1" class="result"></div>
    </div>
    
    <div class="test-case">
        <h2>Test 2: St√¶rkt CV (Forventet score: ~90)</h2>
        <button onclick="testStrongCV()">Test St√¶rkt CV</button>
        <div id="result2" class="result"></div>
    </div>
    
    <div class="test-case">
        <h2>Test 3: CV med fejl (Forventet score: ~60)</h2>
        <button onclick="testFlawedCV()">Test Fejlbeh√¶ftet CV</button>
        <div id="result3" class="result"></div>
    </div>
    
    <div class="test-case">
        <h2>Test 4: Tomt CV (Forventet score: ~50)</h2>
        <button onclick="testEmptyCV()">Test Tomt CV</button>
        <div id="result4" class="result"></div>
    </div>
    
    <div class="test-case">
        <h2>Test 5: K√∏r alle tests</h2>
        <button onclick="runAllTests()">K√∏r alle tests automatisk</button>
        <div id="result5" class="result"></div>
    </div>

    <script>
        const testCases = {
            simple: {
                personalInfo: {
                    name: "Anna Nielsen",
                    email: "anna@email.dk",
                    phone: "12345678",
                    location: "K√∏benhavn"
                },
                experiences: [{
                    title: "Butiksassistent",
                    company: "Netto",
                    duration: "2023-2024",
                    description: "Ekspedition af kunder"
                }],
                education: [{
                    degree: "Gymnasial uddannelse",
                    institution: "√òrestad Gymnasium",
                    year: "2023"
                }],
                skills: ["Kundeservice", "Teamwork"],
                profileText: "Jeg er motiveret."
            },
            
            strong: {
                personalInfo: {
                    name: "Michael Andersen",
                    email: "michael.andersen@email.dk",
                    phone: "87654321",
                    location: "Aarhus"
                },
                experiences: [{
                    title: "Senior Software Developer",
                    company: "TechCorp Denmark",
                    duration: "2020-2024",
                    description: "Ledte udvikling af microservices-arkitektur for e-handelsplatform der serverer 500.000+ daglige brugere. Reducerede responstid med 40% gennem optimering af database-queries og implementering af caching-strategier."
                }],
                education: [{
                    degree: "Kandidat i Datalogi",
                    institution: "Aarhus Universitet",
                    year: "2018"
                }],
                skills: ["JavaScript", "React", "Node.js", "TypeScript", "Docker", "AWS", "PostgreSQL", "Redis", "Microservices", "Agile", "Scrum", "Mentoring"],
                profileText: "Erfaren Senior Software Developer med 6+ √•rs dokumenteret erfaring inden for full-stack udvikling og teamledelse. Specialiseret i at bygge skalerbare web-applikationer der h√•ndterer h√∏j trafik og komplekse forretningsprocesser."
            },
            
            flawed: {
                personalInfo: {
                    name: "Peter",
                    email: "invalidmail",
                    phone: "123",
                    location: ""
                },
                experiences: [{
                    title: "",
                    company: "Firma",
                    duration: "2020",
                    description: "Arbejdede med ting"
                }],
                education: [],
                skills: ["Ting", "Stuff"],
                profileText: "Jeg er god til ting og s√∏ger job."
            },
            
            empty: {
                personalInfo: {
                    name: "",
                    email: "",
                    phone: "",
                    location: ""
                },
                experiences: [],
                education: [],
                skills: [],
                profileText: ""
            }
        };

        async function testCV(testData, resultElementId) {
            const resultElement = document.getElementById(resultElementId);
            resultElement.innerHTML = '<p>Tester...</p>';
            
            try {
                const response = await fetch('/api/ai/cv-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ cvData: testData })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                console.log('CV Analysis Result:', result);
                
                let html = `
                    <div class="success">
                        <h3>‚úÖ Analyse Succes</h3>
                        <p><strong>Score:</strong> ${result.overall_score}/100</p>
                        <p><strong>Styrker (${result.strengths.length}):</strong></p>
                        <ul>${result.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                        <p><strong>Forbedringer (${result.improvements.length}):</strong></p>
                        <ul>${result.improvements.map(i => `<li>${i}</li>`).join('')}</ul>
                `;
                
                if (result.optimized_profile) {
                    html += `<p><strong>Optimeret profiltekst:</strong> ${result.optimized_profile}</p>`;
                }
                
                if (result.specific_suggestions) {
                    html += `<p><strong>Specifikke forslag:</strong> ${JSON.stringify(result.specific_suggestions, null, 2)}</p>`;
                }
                
                html += `</div>`;
                resultElement.innerHTML = html;
                
            } catch (error) {
                console.error('CV Test Error:', error);
                resultElement.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Test Fejl</h3>
                        <p><strong>Fejl:</strong> ${error.message}</p>
                        <p><strong>Tidspunkt:</strong> ${new Date().toLocaleString()}</p>
                    </div>
                `;
            }
        }
        
        function testSimpleCV() {
            testCV(testCases.simple, 'result1');
        }
        
        function testStrongCV() {
            testCV(testCases.strong, 'result2');
        }
        
        function testFlawedCV() {
            testCV(testCases.flawed, 'result3');
        }
        
        function testEmptyCV() {
            testCV(testCases.empty, 'result4');
        }
        
        async function runAllTests() {
            const resultElement = document.getElementById('result5');
            resultElement.innerHTML = '<p>K√∏rer alle tests...</p>';
            
            const testResults = [];
            
            for (const [testName, testData] of Object.entries(testCases)) {
                try {
                    const response = await fetch('/api/ai/cv-analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ cvData: testData })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    testResults.push({
                        name: testName,
                        status: 'SUCCESS',
                        score: result.overall_score,
                        strengths: result.strengths.length,
                        improvements: result.improvements.length
                    });
                    
                } catch (error) {
                    testResults.push({
                        name: testName,
                        status: 'FAILED',
                        error: error.message
                    });
                }
            }
            
            let summaryHTML = '<div class="success"><h3>üìä Test Sammenfatning</h3>';
            const successCount = testResults.filter(r => r.status === 'SUCCESS').length;
            const failCount = testResults.filter(r => r.status === 'FAILED').length;
            
            summaryHTML += `<p><strong>Resultater:</strong> ${successCount}/${testResults.length} tests gennemf√∏rt</p>`;
            if (failCount > 0) {
                summaryHTML += `<p style="color: red;"><strong>Fejl:</strong> ${failCount} tests fejlede</p>`;
            }
            
            summaryHTML += '<table border="1" style="width: 100%; margin-top: 10px;"><tr><th>Test</th><th>Status</th><th>Score</th><th>Styrker</th><th>Forbedringer</th></tr>';
            
            testResults.forEach(result => {
                summaryHTML += `<tr>
                    <td>${result.name}</td>
                    <td style="color: ${result.status === 'SUCCESS' ? 'green' : 'red'};">${result.status}</td>
                    <td>${result.score || 'N/A'}</td>
                    <td>${result.strengths || 'N/A'}</td>
                    <td>${result.improvements || 'N/A'}</td>
                </tr>`;
            });
            
            summaryHTML += '</table></div>';
            resultElement.innerHTML = summaryHTML;
        }
        
        // Auto-run first test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CV-Bygger Test Debug Page loaded');
            console.log('Available test cases:', Object.keys(testCases));
        });
    </script>
</body>
</html>